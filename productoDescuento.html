<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¡Canjea tus Puntos Level-Up!</title>
    <link rel="stylesheet" href="CSS/estilos.css" />
</head>
<body>
    <header>
        <h1>Level Up Gamer</h1>
        <nav class="menu">
            <a href="index.html">Inicio</a> | 
            <a href="productos.html">Productos</a> | 
            <a href="gestionUsuario.html">Usuario</a>|
            <a href="productoDescuento.html">Canjea Productos</a> |
            <a href="canje.html">Referidos</a> 
        </nav>
        <div class="levelup-puntos" id="levelup-puntos">
            Puntos Level-Up: <span id="puntos-actuales">350</span>
        </div>
    </header>

    <section class="extracto">
        <h2>Catálogo de Productos para Canje</h2>
        <label for="filtro-categoria">Filtrar por categoría:</label>
        <select id="filtro-categoria">
            <option value="todos">Todos</option>
            <option value="consolas">Consolas</option>
            <option value="accesorios">Accesorios</option>
            <option value="computadores-gamers">Computadores Gamers</option>
            <option value="sillas-gamers">Sillas Gamers</option>
            <option value="juegos-de-mesa">Juegos de mesa</option>
            <option value="mouse">Mouse</option>
            <option value="mousepad">Mousepad</option>
            <option value="poleras-personalizadas">Poleras Personalizadas</option>
        </select>

        <!-- Agrega esto después del filtro de categoría -->
        <div id="carrito-canje" style="background:#f3f3f3; padding:10px; margin:20px 0; border-radius:8px;">
            <h3>Carrito de Canje</h3>
            <ul id="lista-carrito-canje"></ul>
            <div id="total-carrito-canje"></div>
        </div>

        <div class="productos-lista">
            <div class="producto" data-categoria="juegos-de-mesa"
                data-nombre="Catan"
                data-puntos="300"
                data-descuento="0"
                data-descripcion="Un clásico juego de estrategia donde los jugadores compiten por colonizar y expandirse en la isla de Catan. Ideal para 3-4 jugadores y perfecto para noches de juego en familia o con amigos. <br><strong>Fabricante:</strong> Kosmos | <strong>Distribuidor:</strong> Devir."
                data-img="images/catan.png"
                data-reseñas='["Muy entretenido para jugar en familia.", "Excelente calidad de piezas.","4⭐"]'>
                <img src="images/catan.png" alt="Catan" class="producto-img" />
                <h3>Catan</h3>
                <p>Juego de mesa clásico de estrategia.</p>
                <p><strong>300 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('Catan', 300)">Canjear</button>
            </div>

            <div class="producto" data-categoria="juegos-de-mesa"
                data-nombre="Carcassonne"
                data-puntos="220"
                data-descuento="10"
                data-descripcion="Un juego de colocación de fichas donde los jugadores construyen el paisaje alrededor de la fortaleza medieval de Carcassonne. Ideal para 2-5 jugadores y fácil de aprender. <br><strong>Fabricante:</strong> Hans im Glück | <strong>Distribuidor:</strong> Devir."
                data-img="images/carcassonne.png"
                data-reseñas='["Perfecto para iniciar en juegos de mesa.", "Muy divertido y fácil de aprender.","5⭐"]'>
                <img src="images/carcassonne.png" alt="Carcassonne" class="producto-img" />
                <h3>Carcassonne</h3>
                <div class="descuento">10% menos puntos</div>
                <p>Juego de colocación de fichas.</p>
                <p><strong>198 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('Carcassonne', 198)">Canjear</button>
            </div>

            <div class="producto" data-categoria="accesorios"
                data-nombre="Controlador Inalámbrico Xbox Series X"
                data-puntos="600"
                data-descuento="0"
                data-descripcion="Ofrece una experiencia de juego cómoda con botones mapeables y una respuesta táctil mejorada. Compatible con consolas Xbox y PC. <br><strong>Fabricante:</strong> Microsoft | <strong>Distribuidor:</strong> Microsoft Store."
                data-img="images/xbox-controller.jpg"
                data-reseñas='["Muy cómodo y preciso.", "Funciona perfecto en PC y Xbox.","4⭐"]'>
                <img src="images/xbox-controller.jpg" alt="Controlador Xbox" class="producto-img" />
                <h3>Controlador Inalámbrico Xbox Series X</h3>
                <p>Control inalámbrico para Xbox y PC.</p>
                <p><strong>600 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('Controlador Inalámbrico Xbox Series X', 600)">Canjear</button>
            </div>

            <div class="producto" data-categoria="accesorios"
                data-nombre="Auriculares Gamer HyperX Cloud II"
                data-puntos="800"
                data-descuento="20"
                data-descripcion="Proporcionan un sonido envolvente de calidad con un micrófono desmontable y almohadillas de espuma viscoelástica para mayor comodidad durante largas sesiones de juego. <br><strong>Fabricante:</strong> HyperX | <strong>Distribuidor:</strong> Kingston Technology."
                data-img="images/hyperx-cloud2.jpg"
                data-reseñas='["Sonido excelente y muy cómodos.", "El micrófono es muy claro.","5⭐"]'>
                <img src="images/hyperx-cloud2.jpg" alt="HyperX Cloud II" class="producto-img" />
                <h3>Auriculares Gamer HyperX Cloud II <span class="descuento">20% menos puntos</span></h3>
                <p>Sonido envolvente y micrófono desmontable.</p>
                <p><strong>640 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('Auriculares Gamer HyperX Cloud II', 640)">Canjear</button>
            </div>

            <div class="producto" data-categoria="consolas"
                data-nombre="PlayStation 5"
                data-puntos="5500"
                data-descuento="0"
                data-descripcion="La consola de última generación de Sony, que ofrece gráficos impresionantes y tiempos de carga ultrarrápidos para una experiencia de juego inmersiva. <br><strong>Fabricante:</strong> Sony Interactive Entertainment | <strong>Distribuidor:</strong> Sony Store."
                data-img="images/ps5.jpg"
                data-reseñas='["Gráficos increíbles.", "Carga los juegos rapidísimo.","5⭐"]'>
                <img src="images/ps5.jpg" alt="PlayStation 5" class="producto-img" />
                <h3>PlayStation 5</h3>
                <p>Consola de última generación.</p>
                <p><strong>5500 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('PlayStation 5', 5500)">Canjear</button>
            </div>

            <div class="producto" data-categoria="computadores-gamers"
                data-nombre="PC Gamer ASUS ROG Strix"
                data-puntos="12000"
                data-descuento="0"
                data-descripcion="Un potente equipo diseñado para los gamers más exigentes, equipado con los últimos componentes para ofrecer un rendimiento excepcional en cualquier juego. <br><strong>Fabricante:</strong> ASUS | <strong>Distribuidor:</strong> ASUS Store."
                data-img="images/asus-rog-strix.jpg"
                data-reseñas='["Rinde excelente en todos los juegos.", "Muy silencioso y rápido.","4⭐"]'>
                <img src="images/asus-rog-strix.jpg" alt="PC Gamer ASUS ROG Strix" class="producto-img" />
                <h3>PC Gamer ASUS ROG Strix</h3>
                <p>Equipo de alto rendimiento para gamers.</p>
                <p><strong>12000 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('PC Gamer ASUS ROG Strix', 12000)">Canjear</button>
            </div>

            <div class="producto" data-categoria="sillas-gamers"
                data-nombre="Silla Gamer Secretlab Titan"
                data-puntos="350"
                data-descuento="15"
                data-descripcion="Diseñada para el máximo confort, esta silla ofrece un soporte ergonómico y personalización ajustable para sesiones de juego prolongadas. <br><strong>Fabricante:</strong> Secretlab | <strong>Distribuidor:</strong> Secretlab."
                data-img="images/secretlab-titan.jpg"
                data-reseñas='["Muy cómoda para largas sesiones.", "Materiales de alta calidad.","4⭐"]'>
                <img src="images/secretlab-titan.jpg" alt="Silla Gamer Secretlab Titan" class="producto-img" />
                <h3>Silla Gamer Secretlab Titan <span class="descuento">15% menos puntos</span></h3>
                <p>Soporte ergonómico y personalización.</p>
                <p><strong>298 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('Silla Gamer Secretlab Titan', 298)">Canjear</button>
            </div>

            <div class="producto" data-categoria="mouse"
                data-nombre="Mouse Gamer Logitech G502 HERO"
                data-puntos="120"
                data-descuento="0"
                data-descripcion="Con sensor de alta precisión y botones personalizables, este mouse es ideal para gamers que buscan un control preciso y personalización. <br><strong>Fabricante:</strong> Logitech | <strong>Distribuidor:</strong> Logitech Store."
                data-img="images/logitech-g502.jpg"
                data-reseñas='["Precisión increíble.", "Muy configurable y cómodo.","4⭐"]'>
                <img src="images/logitech-g502.jpg" alt="Mouse Gamer Logitech G502 HERO" class="producto-img" />
                <h3>Mouse Gamer Logitech G502 HERO</h3>
                <p>Sensor de alta precisión y botones personalizables.</p>
                <p><strong>120 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('Mouse Gamer Logitech G502 HERO', 120)">Canjear</button>
            </div>

            <div class="producto" data-categoria="mousepad"
                data-nombre="Mousepad Razer Goliathus Extended Chroma"
                data-puntos="90"
                data-descuento="0"
                data-descripcion="Ofrece un área de juego amplia con iluminación RGB personalizable, asegurando una superficie suave y uniforme para el movimiento del mouse. <br><strong>Fabricante:</strong> Razer | <strong>Distribuidor:</strong> Razer Store."
                data-img="images/razer-goliathus.jpg"
                data-reseñas='["La iluminación RGB es espectacular.", "Superficie muy suave.","5⭐"]'>
                <img src="images/razer-goliathus.jpg" alt="Mousepad Razer Goliathus Extended Chroma" class="producto-img" />
                <h3>Mousepad Razer Goliathus Extended Chroma</h3>
                <p>Área amplia e iluminación RGB.</p>
                <p><strong>90 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('Mousepad Razer Goliathus Extended Chroma', 90)">Canjear</button>
            </div>

            <div class="producto" data-categoria="poleras-personalizadas"
                data-nombre="Polera Gamer Personalizada 'Level-Up'"
                data-puntos="60"
                data-descuento="0"
                data-descripcion="Una camiseta cómoda y estilizada, con la posibilidad de personalizarla con tu gamer tag o diseño favorito. <br><strong>Fabricante:</strong> Level-Up Gamer | <strong>Distribuidor:</strong> Level-Up Gamer."
                data-img="images/polera-personalizada.png"
                data-reseñas='["Muy cómoda y el diseño es genial.", "Me encantó poder personalizarla.","5⭐"]'>
                <img src="images/polera-personalizada.png" alt="Polera Gamer Personalizada Level-Up" class="producto-img" />
                <h3>Polera Gamer Personalizada 'Level-Up'</h3>
                <p>Camiseta personalizada para gamers.</p>
                <p><strong>60 Puntos Level-Up</strong></p>
                <button class="canjear-btn" onclick="canjearProducto('Polera Gamer Personalizada Level-Up', 60)">Canjear</button>
            </div>
        </div>
    </section>

    <!-- Modal para detalle de producto -->
    <div id="modal-detalle" class="modal-detalle">
        <div class="modal-contenido">
            <span class="modal-cerrar" id="cerrar-modal">&times;</span>
            <h2 id="modal-nombre"></h2>
            <img id="modal-img" src="" alt="" style="max-width:180px; margin-bottom:10px;" />
            <p id="modal-descripcion"></p>
            <div id="modal-reseñas">
                <h3>Reseñas</h3>
                <ul id="modal-lista-reseñas"></ul>
            </div>
        </div>
    </div>

    <script>
    // Redirige a gestión de usuario si no hay un usuario actual


    // Lee los puntos Level-Up desde localStorage o inicia en 0 si no hay
    let puntosLevelUp = parseInt(localStorage.getItem('puntosLevelUp')) || 0;
    document.getElementById('puntos-actuales').textContent = puntosLevelUp;

    // Filtro por categoría
    document.getElementById('filtro-categoria').addEventListener('change', function() {
        const categoriaSeleccionada = this.value;
        const productos = document.querySelectorAll('.producto');
        productos.forEach(producto => {
            const categoriaProducto = producto.getAttribute('data-categoria');
            if (categoriaSeleccionada === 'todos' || categoriaProducto === categoriaSeleccionada) {
                producto.style.display = 'block';
            } else {
                producto.style.display = 'none';
            }
        });
        document.getElementById('modal-detalle').style.display = 'none';
    });

    // Mostrar detalles y reseñas en modal al hacer clic en un producto
    document.querySelectorAll('.producto').forEach(producto => {
        producto.addEventListener('click', function(e) {
            document.getElementById('modal-detalle').style.display = 'block';
            document.getElementById('modal-nombre').textContent = producto.getAttribute('data-nombre');
            document.getElementById('modal-img').src = producto.getAttribute('data-img');
            document.getElementById('modal-img').alt = producto.getAttribute('data-nombre');
            document.getElementById('modal-descripcion').innerHTML = producto.getAttribute('data-descripcion');
            // Reseñas
            const reseñas = JSON.parse(producto.getAttribute('data-reseñas') || "[]");
            const listaReseñas = document.getElementById('modal-lista-reseñas');
            listaReseñas.innerHTML = "";
            reseñas.forEach(r => {
                const li = document.createElement('li');
                li.textContent = r;
                listaReseñas.appendChild(li);
            });
        });

        // Evita que el clic en el botón dispare el evento del producto
        producto.querySelector('.canjear-btn').addEventListener('click', function(e) {
            e.stopPropagation();
        });
    });

    // Cerrar modal al hacer clic en la X
    document.getElementById('cerrar-modal').onclick = function() {
        document.getElementById('modal-detalle').style.display = 'none';
    };

    // Opcional: cerrar modal al hacer clic fuera del contenido
    window.onclick = function(event) {
        const modal = document.getElementById('modal-detalle');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };

    // --- Manejo del carrito en localStorage ---
    function agregarAlCarritoGratis(nombre) {
        // Recupera el carrito actual o crea uno nuevo
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        // Verifica si el producto ya está en el carrito
        const existente = carrito.find(item => item.nombre === nombre && item.precio === 0);
        if (existente) {
            existente.cantidad += 1;
        } else {
            carrito.push({ nombre: nombre, precio: 0, cantidad: 1 });
        }
        localStorage.setItem('carrito', JSON.stringify(carrito));
    }

    function mostrarCarritoCanje() {
        const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        const lista = document.getElementById('lista-carrito-canje');
        const totalDiv = document.getElementById('total-carrito-canje');
        lista.innerHTML = '';
        let totalPuntos = 0;

        if (carrito.length === 0) {
            lista.innerHTML = '<li>El carrito está vacío.</li>';
            totalDiv.innerHTML = '';
            return;
        }

        carrito.forEach((item, idx) => {
            // Busca el producto en la lista para saber cuántos puntos costó originalmente
            const productoDiv = Array.from(document.querySelectorAll('.producto'))
                .find(p => p.getAttribute('data-nombre') === item.nombre);
            let puntosNecesarios = 0;
            if (productoDiv) {
                const descuento = parseInt(productoDiv.getAttribute('data-descuento')) || 0;
                const base = parseInt(productoDiv.getAttribute('data-puntos')) || 0;
                puntosNecesarios = descuento > 0 ? Math.round(base * (1 - descuento / 100)) : base;
            }
            totalPuntos += puntosNecesarios * item.cantidad;

            const li = document.createElement('li');
            li.innerHTML = `
                ${item.nombre} - Cantidad: 
                <button onclick="cambiarCantidadCarrito(${idx}, -1)">-</button>
                <span>${item.cantidad}</span>
                <button onclick="cambiarCantidadCarrito(${idx}, 1)">+</button>
                <button onclick="eliminarDelCarritoCanje(${idx})">Eliminar</button>
                <br>Puntos necesarios: ${puntosNecesarios * item.cantidad}
            `;
            lista.appendChild(li);
        });

        totalDiv.innerHTML = `
            <strong>Puntos necesarios para canjear todo: ${totalPuntos}</strong><br>
            <button id="btn-canjear-carrito" ${puntosLevelUp < totalPuntos ? 'disabled' : ''}>
                Canjear Carrito
            </button>
            <div id="mensaje-canje-carrito" style="margin-top:8px;"></div>
        `;

        // Asigna evento al botón
        const btn = document.getElementById('btn-canjear-carrito');
        if (btn) {
            btn.onclick = function() {
                canjearCarrito(totalPuntos);
            };
        }
    }

    function cambiarCantidadCarrito(idx, delta) {
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        carrito[idx].cantidad += delta;
        if (carrito[idx].cantidad < 1) carrito[idx].cantidad = 1;
        localStorage.setItem('carrito', JSON.stringify(carrito));
        mostrarCarritoCanje();
    }

    function eliminarDelCarritoCanje(idx) {
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        carrito.splice(idx, 1);
        localStorage.setItem('carrito', JSON.stringify(carrito));
        mostrarCarritoCanje();
    }

    function canjearCarrito(totalPuntos) {
        const mensajeDiv = document.getElementById('mensaje-canje-carrito');
        if (puntosLevelUp < totalPuntos) {
            mensajeDiv.innerHTML = `<span style="color:red;">No tienes suficientes puntos Level-Up para canjear todos los productos del carrito.</span>`;
            return;
        }
        puntosLevelUp -= totalPuntos;
        localStorage.setItem('puntosLevelUp', puntosLevelUp);
        document.getElementById('puntos-actuales').textContent = puntosLevelUp;
        localStorage.setItem('carrito', JSON.stringify([]));

        // Guarda el mensaje de éxito
        const mensajeExito = `<span style="color:green;">
            ¡Canje realizado correctamente!<br>
            Recibirás un voucher de confirmación en tu correo electrónico.<br>
            Gracias por usar tus puntos Level-Up.
        </span>`;

        mostrarCarritoCanje();

        // Si el carrito está vacío, vuelve a mostrar el mensaje
        document.getElementById('total-carrito-canje').innerHTML = mensajeExito;

        actualizarBotonesCanje();
    }

    // Llama a la función al cargar la página y después de cada canje
    mostrarCarritoCanje();

    // Modifica canjearProducto para actualizar el carrito visual
    function canjearProducto(nombre, puntosNecesarios) {
        agregarAlCarritoGratis(nombre);
        alert(`¡Has agregado "${nombre}" al carrito de canje!`);
        actualizarBotonesCanje();
        mostrarCarritoCanje(); // <-- Actualiza el carrito visual
    }

    // Deshabilita botones si no tienes puntos suficientes
    function actualizarBotonesCanje() {
        document.querySelectorAll('.producto').forEach(producto => {
            const puntosNecesarios = parseInt(producto.getAttribute('data-descuento')) > 0
                ? Math.round(parseInt(producto.getAttribute('data-puntos')) * (1 - parseInt(producto.getAttribute('data-descuento')) / 100))
                : parseInt(producto.getAttribute('data-puntos'));
            const btn = producto.querySelector('.canjear-btn');
            btn.disabled = puntosLevelUp < puntosNecesarios;
        });
    }

    // Actualiza botones al cargar y al canjear
    actualizarBotonesCanje();
    document.getElementById('filtro-categoria').addEventListener('change', actualizarBotonesCanje);
    </script>
</body>
</html>